<h1>Die Jasserei am <%=@date.strftime("%d. %b %Y")%></h1>
 
<h3>Eingegebene Tableaus</h3>
<% for round in @rounds -%>
	Tableau eingegeben von <%= h round.creator %>: <%=h(round.jassers.map{|a| a.name}.to_sentence(words_connector: ", ", last_word_connector: "&")) %><br />
<% end -%>

<h3>Die Ergebnisse der Spieler</h3>
<table class="ranking">
	<tr >
		<th>Rang</th>
		<th class="string <%= cyc_color%>">Jasser</th>
		<th <%=cyc_color_class %>>Spiele</th>
		<th <%=cyc_color_class %>>Differenz</th>
		<th <%=cyc_color_class %>>Schnitt</th>
		<th <%=cyc_color_class %>>Max</th>
		<th <%=cyc_color_class %>>Rösi</th>
		<th <%=cyc_color_class %>>2xRösi</th>
		<th <%=cyc_color_class %>>Versenkt</th>
		<th <%=cyc_color_class %>>Match</th>
		<th <%=cyc_color_class %>>H.Match</th>
		<th <%=cyc_color_class %>>Dähler-Ris</th>
	</tr>
	<% if @ranking.size > 0 -%>
		<% for stat in @ranking -%>
			<% reset_cycle("colors") -%>
			<tr <% if @rank==0 || @rank==3 %>class="trennung_top"<% end %> >
				<td><%= n 0, @rank +=1 %></td>
				<td class="string <%= cyc_color%>"><%= stat["jasser"].name %></td>
				<td <%=cyc_color_class %>><%= n 0, stat["spiele"] %></td>
				<td <%=cyc_color_class %>><%= n 0, stat["differenz"] %></td>
				<td <%=cyc_color_class %>><%= n 2, stat["schnitt"] %></td>
				<td <%=cyc_color_class %>><%= n 0, stat["maximum"] %></td>
				<% for col in @additional_columns -%>
					<td <%=cyc_color_class %>><%= n 0, stat[col] %></td>
				<% end -%>
			<tr>
		<% end -%>
		<tr class="trennung_top">
			<% reset_cycle("colors") -%>
			<td></td>
			<td class="string <%= cyc_color%>">Total</td>
			<td <%=cyc_color_class %>><%= @totals["spiele"] %></td>
			<td <%=cyc_color_class %>><%= @totals["differenz"] %></td>
			<td <%=cyc_color_class %>> </td>
			<td <%=cyc_color_class %>><%= @totals["maximum"] %></td>
			<% for col in @additional_columns -%>
				<td <%=cyc_color_class %>><%= n 0, @totals[col] %></td>
			<% end -%>
		</tr>
		<tr>
			<td></td>
			<% reset_cycle("colors") -%>
			<td class="string <%= cyc_color%>">Schnitt</td>
			<td <%=cyc_color_class %>><%= n 2, @totals["spiele"]/@rank %></td>
			<td <%=cyc_color_class %>><%= n 2, @totals["differenz"]/@rank %></td>
			<td <%=cyc_color_class %>><%= n 2, @totals["differenz"]/@totals["spiele"].to_f %></td>
			<td <%=cyc_color_class %>> </td>
			<% for col in @additional_columns -%>
				<td <%=cyc_color_class %>><%= n 2, @totals[col]/@rank %></td>
			<% end -%>
		</tr>
	<% else %>
		<tr>
			<td colspan=12 style="padding:15px;text-align:center;">In diesem Jahr wurde kein Spiel eingetragen</td>
		</tr>
	<% end -%>
</table>



<h3>Rangverschiebungen</h3>
<table class="ranking">
	<% reset_cycle("colors") -%>
	<tr>
		<th>Rang</th>
		<th class="string <%= cyc_color%>">Jasser</th>
		<th class="string <%= cyc_color%>">Rang-Sprung</th>
		<th <%=cyc_color_class %>>Schnitt vorher</th>
		<th <%=cyc_color_class %>>Schnitt nachher</th>
		<th <%=cyc_color_class %>>Spiele vorher</th>
		<th <%=cyc_color_class %>>Spiele nachher</th>
		<th <%=cyc_color_class %>>Differenz vorher</th>
		<th <%=cyc_color_class %>>Differenz nachher</th>
		<th <%=cyc_color_class %>>Rang vorher</th>
		<th <%=cyc_color_class %>>Rang nachher</th>
	</tr>
	<% for stat in @rangverschiebung -%>
	<% reset_cycle("colors") -%>
		<tr>
			<td ><%= stat[:rang_nachher]%></td>
			<% puts stat.inspect %>
			<td class="string <%= cyc_color%>"><%= h  stat[:jasser_name]%></td>
			<td class="string <%= cyc_color%>"><%= n 0, stat[:rang_sprung]%> <%= h stat[:sprung_am_gruenen_tisch]%></td>
			<td <%=cyc_color_class %>><%= n 2, stat[:schnitt_vorher]%></td>
			<td <%=cyc_color_class %>><%= n 2, stat[:schnitt_nachher]%></td>
			<td <%=cyc_color_class %>><%= stat[:spiele_vorher]%></td>
			<td <%=cyc_color_class %>><%= stat[:spiele_nachher]%></td>
			<td <%=cyc_color_class %>><%= stat[:differenz_vorher]%></td>
			<td <%=cyc_color_class %>><%= stat[:differenz_nachher]%></td>
			<td <%=cyc_color_class %>><%= stat[:rang_vorher]%></td>
			<td <%=cyc_color_class %>><%= stat[:rang_nachher]%></td>
		</tr>
	<% end -%>
	<% reset_cycle("colors") -%>
	<tr>
		<td></td>
		<td class="string <%= cyc_color%>">Total</td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>><%= diffpr = @rangverschiebung.sum{|x| x[:differenz_vorher].to_i}%></td>
		<td <%=cyc_color_class %>><%= diffpo = @rangverschiebung.sum{|x| x[:differenz_nachher].to_i}%></td>
		<td <%=cyc_color_class %>><%= spielepr = @rangverschiebung.sum{|x| x[:spiele_vorher].to_i}%></td>
		<td <%=cyc_color_class %>><%= spielepo = @rangverschiebung.sum{|x| x[:spiele_nachher].to_i}%></td>
	</tr>
	<tr>
		<% reset_cycle("colors") -%>
		<td></td>
		<td class="string <%= cyc_color%>">Schnitt</td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>><%= n 2, diffpr/spielepr.to_f %></td>
		<td <%=cyc_color_class %>><%= n 2, diffpo/spielepo.to_f %></td>
		<td <%=cyc_color_class %>><%= n 1, spielepr/@rangverschiebung.size.to_f %></td>
		<td <%=cyc_color_class %>><%= n 1, spielepo/@rangverschiebung.size.to_f %></td>
		<td <%=cyc_color_class %>><%= n 1, diffpr/@rangverschiebung.size.to_f %></td>
		<td <%=cyc_color_class %>><%= n 1, diffpo/@rangverschiebung.size.to_f %></td>
		<td <%=cyc_color_class %>></td>
		<td <%=cyc_color_class %>></td>
	</tr>
</table>